var Draw={image:function(a,b,c,d){var e=new Image;e.src=c,e.onload=function(){d.drawImage(e,a,b)}}},Animation=function(a,b){this.options=a,this.action=b};Animation.prototype.run=function(){this.action(this.options)};var Layer=function(a,b,c){this.id=a,this.context=c,this.level=b,this.drawQueue=[],this.animationQueue=[]};Layer.prototype.append=function(a){return this.drawQueue.push(a),this},Layer.prototype.appendAnimation=function(a){this.animationQueue.push(a)},Layer.prototype.draw=function(){this.drawQueue.forEach(function(a){a()}),this.animationQueue.forEach(function(a){a.run()})};var Defaults={Animation:{background_horizontal_parallax:function(a,b,c){return new Animation({x:0,y:0,speed:c,context:a},function(a){a.x<-a.context.canvas.clientWidth?a.x=0:a.x=a.x-animation.speed,Draw.image(a.x,a.y,b,a.context),Draw.image(a.context.canvas.clientWidth+a.x,a.y,b,a.context)})}}},Scene=function(a){this.canvas=document.getElementById(a),this.context=canvas.getContext("2d"),this.layers=[]};Scene.prototype.background=function(a,b){this.addLayer("background",0),b.horizontalScroll?this._setAnimatedBackground(a,b):this._setBackground(a)},Scene.prototype._setAnimatedBackground=function(a,b){this._addImageAnimation(a,Defaults.Animation.background_horizontal_parallax(this.context,a,b.speed))},Scene.prototype._setBackground=function(a){this._addImage(a,"background",0,0)},Scene.prototype.addImage=function(a,b){b.animation?this._addImageAnimation(a,b.animation):this._addImage(a,b.layer,b.x,b.y)},Scene.prototype._addImageAnimation=function(a,b){_.find(this.layers,function(a){return a.id==layer}).appendAnimation(b).draw()},Scene.prototype._addImage=function(a,b,c,d){_.find(this.layers,function(a){return a.id==b}).append(function(){Draw.image(c,d,a,this.context)}.bind(this)).draw()},Scene.prototype.addLayer=function(a,b){this.layers.push(new Layer(a,b,this.context))},Scene.prototype.initialize=function(a){setInterval(this._loop_.bind(this),a.refreshRate||15)},Scene.prototype._loop_=function(){var a=_.sortBy(this.layers,function(a){return a.level});_.each(a,function(a){a.draw()}.bind(this))};var scene=new Scene("canvas");scene.background("assets/background.png",{horizontalScroll:!0,speed:2}),scene.addLayer("hero",1),scene.addImage("assets/flappy01.png",{layer:"hero",x:10,y:200}),scene.initialize({refreshRate:15});
//# sourceMappingURL=game.min.js.map